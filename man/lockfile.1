.de Id
.ds Rv \\$3
.ds Dt \\$4
..
.Id $Id: lockfile.1,v 2.2 1991/07/03 13:54:04 berg Rel $
.de Sh
.br
.ne 9
.SH "\\$1"
..
.de Ss
.br
.ne 9
.SS "\\$1"
..
.de Tp
.br
.ne 9
.TP "\\$1"
..
.TH LOCKFILE 1 \*(Dt BuGless
.SH NAME
lockfile \- conditional semaphore-file creator
.SH SYNOPSIS
.B lockfile
.I "\fB\-\fPsleeptime"
|
.I "\fB\-r\fPretries"
|
.B "\-!"
|
.if n .ti +0.5i
.I "\fB\-l\fPlocktimeout"
|
.I "\fB\-s\fPsuspend"
|
.I filename
\&.\|.\|.
.Sh DESCRIPTION
.B lockfile
can be used to create one or more
.I semaphore
.IR files .
If lockfile can't create all the specified files (in the specified order),
it waits
.I sleeptime
(defaults to 8) seconds and retries the last file that didn't succeed.
You can specify the number of
.I retries
to do until failure is returned.
If the number of
.I retries
is 0 (default) lockfile will retry forever.
.LP
If the number of
.I retries
expires before all files have been created, lockfile returns failure and
removes all the files it created up till that point.
.LP
The return value of lockfile can be easily inverted by specifying
.B \-!
as an argument (comes in handy in shell scripts).
.LP
All flags can be specified anywhere on the command line, they will be
processed when encountered.  The command line is simply parsed from
left to right.
.LP
All files created by lockfile will have access permission 0, and therefore
will have to be removed with
.B rm
.BR \-f .
.LP
If you specify a
.I locktimeout
then a lockfile will be removed by force after locktimeout seconds have
passed since the lockfile was last modified/created.  After a lockfile is
removed by  force, a suspension of
.I suspend
seconds (defaults to 16) is taken into account, in order to prevent the
inadvertent immediate removal of any newly created lockfile by another program
(compare
.BR SUSPEND
in
.BR procmail (1)).
.Sh "SEE ALSO"
.LP
.BR rm (1),
.BR mail (1),
.BR binmail (1),
.BR sendmail (8),
.BR procmail (1)
.Sh DIAGNOSTICS
.Tp 2.3i
Forcing lock on "x"
Specified lockfile is going to be removed by force because of a timeout
(compare
.BR LOCKTIMEOUT
in
.BR procmail (1)).
.Sh BUGS
.LP
lockfile is only a simple program and can't process concatenated options.
.Sh NOTES
.LP
Multiple
.B \-!
flags will toggle the return status.
.LP
Since flags can occur anywhere on the command line, any filename starting
with a '-' has to be preceded by './'.
.LP
The number of
.I retries
is global.  That is, it is not reset when a new file is being created.
It can, however, be reset by specifying
.RI \-r newretries
after every file on the command line.
.LP
lockfile performs the locking in an NFS-secure way.
.Sh AUTHOR
.LP
Stephen R. van den Berg at RWTH-Aachen, Germany
.RS
berg@messua.informatik.rwth-aachen.de
.br
berg@physik.tu-muenchen.de
.RE
