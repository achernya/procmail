.de Id
.ds Rv \\$3
.ds Dt \\$4
..
.Id $Id: lockfile.man,v 2.6 1992/04/29 15:55:09 berg Rel $
.de Sh
.br
.ne 11
.SH "\\$1"
..
.de Ss
.br
.ne 10
.SS "\\$1"
..
.de Tp
.br
.ne 9
.TP \\$1
..
.de Rs
.na
.nf
.RS
..
.de Re
.RE
.fi
.ad
..
.TH LOCKFILE 1 \*(Dt BuGless
.SH NAME
.na
lockfile \- conditional semaphore-file creator
.SH SYNOPSIS
.B lockfile
.I "\fB\-\fPsleeptime"
|
.I "\fB\-r\fPretries"
|
.B "\-!"
|
.if n .ti +0.5i
.I "\fB\-l\fPlocktimeout"
|
.I "\fB\-s\fPsuspend"
|
.B "\-ml"
|
.B "\-mu"
|
.I filename
\&.\|.\|.
.ad
.Sh DESCRIPTION
.B lockfile
can be used to create one or more
.I semaphore
.IR files .
If lockfile can't create all the specified files (in the specified order),
it waits
.I sleeptime
(defaults to 8) seconds and retries the last file that didn't succeed.
You can specify the number of
.I retries
to do until failure is returned.
If the number of
.I retries
is 0 (default) lockfile will retry forever.
.PP
If the number of
.I retries
expires before all files have been created, lockfile returns failure and
removes all the files it created up till that point.
.PP
The return value of lockfile can be easily inverted by specifying
.B \-!
as an argument (comes in handy in shell scripts).
.PP
All flags can be specified anywhere on the command line, they will be
processed when encountered.  The command line is simply parsed from
left to right.
.PP
All files created by lockfile will have access permission 0, and therefore
will have to be removed with
.B rm
.BR \-f .
.PP
If you specify a
.I locktimeout
then a lockfile will be removed by force after locktimeout seconds have
passed since the lockfile was last modified/created.  Lockfile is clock skew
immune.  After a lockfile has been removed by force, a suspension of
.I suspend
seconds (defaults to 16) is taken into account, in order to prevent the
inadvertent immediate removal of any newly created lockfile by another program
(compare
.BR SUSPEND
in
.BR procmail (1)).
.Ss "Mailbox locks"
If the permissions on the system mail spool directory allow it, or if lockfile
is suitably setuid or setgid, it will be able to lock and unlock your system
mailbox by using the options
.B "\-ml"
and
.B "\-mu"
respectively.
.Sh FILES
.Tp 2.3i
.B  /etc/passwd
to get the invoker's loginname
.B +SYSTEM_MBOX++DEFlockext+
lockfile for the system mailbox
.Sh "SEE ALSO"
.na
.BR rm (1),
.BR mail (1),
.BR binmail (1),
.BR sendmail (8),
.BR procmail (1)
.ad
.Sh DIAGNOSTICS
.Tp 2.3i
Forcing lock on "x"
Specified lockfile is going to be removed by force because of a timeout
(compare
.BR LOCKTIMEOUT
in
.BR procmail (1)).
.Sh BUGS
lockfile is only a simple program and can't process concatenated options.
.Sh NOTES
Multiple
.B \-!
flags will toggle the return status.
.PP
Since flags can occur anywhere on the command line, any filename starting
with a '-' has to be preceded by './'.
.PP
The number of
.I retries
is global.  That is, it is not reset when a new file is being created.
It can, however, be reset by specifying
.RI \-r newretries
after every file on the command line.
.PP
lockfile performs the locking in an NFS-secure way.
.Sh AUTHOR
Stephen R. van den Berg at RWTH-Aachen, Germany
.Rs
berg@pool.informatik.rwth-aachen.de
.br
berg@physik.tu-muenchen.de
.Re
